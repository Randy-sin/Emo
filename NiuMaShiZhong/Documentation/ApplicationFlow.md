# 牛马时钟 - 应用流程文档

## 1. 应用启动流程

### 1.1 设备检测
1. 应用启动时检测设备类型
   - 如果是iPad，加载IPadContentView
   - 如果是iPhone，加载PhoneContentView

### 1.2 数据初始化
1. 从UserDefaults加载工作配置
   - 如果存在配置，使用已保存的配置
   - 如果不存在，使用默认配置：
     - 月薪：30000元
     - 工作时间：09:00-18:00
     - 工作制度：双休
     - 入职日期：2023-11-01

### 1.3 界面初始化
1. 加载渐变背景
2. 初始化计时器（每秒更新）
3. 显示主界面组件

## 2. 主界面操作流程

### 2.1 基础信息显示
1. 顶部显示
   - 应用名称
   - 语言切换按钮
2. 时间显示
   - 实时显示当前时间
   - 使用圆角数字字体
   - 带有数字切换动画

### 2.2 配置信息管理
1. 工作时间设置
   - 点击工作时间卡片
   - 选择上下班时间
   - 自动保存并更新显示

2. 入职日期设置
   - 点击入职日期卡片
   - 选择具体日期
   - 自动保存并更新显示

3. 月薪设置
   - 点击月薪卡片
   - 输入具体金额
   - 自动保存并更新显示

4. 工作制度选择
   - 点击工作制度
   - 从菜单选择：
     - 双休制
     - 单休制
     - 大小周
   - 自动保存并更新显示

### 2.3 收入信息显示
1. 实时显示多个维度收入
   - 今日收入
   - 本月收入
   - 年度收入
   - 总收入
2. 每秒自动更新
3. 带有动画效果

## 3. Widget小组件流程

### 3.1 小组件初始化
1. 从App Group共享的UserDefaults加载配置
2. 如果没有配置，使用默认值
3. 初始化显示数据

### 3.2 数据更新
1. 定时更新Timeline
2. 计算并显示：
   - 当前收入
   - 距离下班时间
3. 应用进入后台时刷新数据

### 3.3 交互响应
1. 点击小组件
   - 打开主应用
   - 显示详细信息

## 4. 设置流程

### 4.1 语言设置
1. 点击顶部语言按钮
2. 打开语言设置面板
3. 选择语言：
   - 简体中文
   - 繁体中文
   - 英文
4. 提示需要重启应用
5. 确认后应用新语言

### 4.2 数据同步
1. 配置变更时：
   - 立即保存到UserDefaults
   - 同步到App Group
   - 触发Widget更新

## 5. 异常处理流程

### 5.1 数据加载异常
1. 配置加载失败时使用默认值
2. JSON解码失败时提供默认配置
3. 保持应用可用性

### 5.2 界面适配
1. 自动适应系统主题
   - 深色模式
   - 浅色模式
2. 自动适应屏幕尺寸
   - iPhone适配
   - iPad适配

## 6. 退出流程

### 6.1 应用进入后台
1. 保存当前配置
2. 刷新Widget数据
3. 维持Widget更新

### 6.2 应用完全退出
1. 保存所有状态
2. 确保数据同步完成
3. Widget继续在后台运行 